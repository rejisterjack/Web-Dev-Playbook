<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>gRPC Customer Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    h1 {
      color: #333;
      text-align: center;
    }
    .container {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .customer-list {
      flex: 1;
      min-width: 500px;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
    }
    .customer-form {
      flex: 1;
      min-width: 300px;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    tr:hover {
      background-color: #f5f5f5;
    }
    .actions {
      display: flex;
      gap: 5px;
    }
    button {
      padding: 5px 10px;
      cursor: pointer;
    }
    form {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    input {
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    .submit-btn {
      background-color: #4CAF50;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
    }
    .reset-btn {
      background-color: #f44336;
      color: white;
      border: none;
      padding: 10px;
      cursor: pointer;
    }
    .info {
      background-color: #e7f3fe;
      border-left: 6px solid #2196F3;
      padding: 10px;
      margin-bottom: 15px;
    }
    .grpc-flow {
      margin: 20px 0;
      padding: 10px;
      background-color: #f9f9f9;
      border-radius: 5px;
      text-align: center;
    }
    .flow-diagram {
      font-family: monospace;
      white-space: pre;
      text-align: center;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <h1>gRPC Customer Management</h1>
  
  <div class="info">
    <p>This application demonstrates gRPC communication between a Node.js server and client.</p>
    <p>The browser communicates with an Express server, which uses gRPC to talk to the backend service.</p>
  </div>

  <div class="grpc-flow">
    <h3>How gRPC Works in this Application</h3>
    <div class="flow-diagram">
      Browser <--> Express Server (REST) <--> gRPC Client <--> gRPC Server <--> Data Store
    </div>
    <p>1. Browser sends HTTP requests to Express</p>
    <p>2. Express server translates requests to gRPC calls</p>
    <p>3. gRPC client communicates with gRPC server using Protocol Buffers</p>
    <p>4. gRPC server processes requests and returns responses</p>
  </div>

  <div class="container">
    <div class="customer-list">
      <h2>Customer List</h2>
      <button id="refresh-btn">Refresh List</button>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="customers-table">
          <!-- Customer data will be loaded here -->
        </tbody>
      </table>
    </div>

    <div class="customer-form">
      <h2 id="form-title">Add New Customer</h2>
      <form id="customer-form">
        <input type="hidden" id="customer-id">
        <div>
          <label for="name">Name:</label>
          <input type="text" id="name" required>
        </div>
        <div>
          <label for="email">Email:</label>
          <input type="email" id="email" required>
        </div>
        <div>
          <label for="phone">Phone:</label>
          <input type="text" id="phone" required>
        </div>
        <div>
          <label for="address">Address:</label>
          <input type="text" id="address">
        </div>
        <div>
          <label for="city">City:</label>
          <input type="text" id="city">
        </div>
        <div>
          <label for="state">State:</label>
          <input type="text" id="state">
        </div>
        <div>
          <label for="zip">ZIP:</label>
          <input type="text" id="zip">
        </div>
        <div>
          <label for="country">Country:</label>
          <input type="text" id="country">
        </div>
        <div>
          <button type="submit" class="submit-btn">Submit</button>
          <button type="button" class="reset-btn" id="reset-form">Reset</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let editing = false;
    const form = document.getElementById('customer-form');
    const formTitle = document.getElementById('form-title');
    const resetBtn = document.getElementById('reset-form');
    const refreshBtn = document.getElementById('refresh-btn');
    
    // Load customers on page load
    document.addEventListener('DOMContentLoaded', loadCustomers);
    refreshBtn.addEventListener('click', loadCustomers);
    
    // Form submit handler
    form.addEventListener('submit', function(event) {
      event.preventDefault();
      
      const customerData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        city: document.getElementById('city').value,
        state: document.getElementById('state').value,
        zip: document.getElementById('zip').value,
        country: document.getElementById('country').value,
        orders: []
      };
      
      if (editing) {
        const id = document.getElementById('customer-id').value;
        updateCustomer(id, customerData);
      } else {
        createCustomer(customerData);
      }
    });
    
    // Reset form button
    resetBtn.addEventListener('click', resetForm);
    
    // Load all customers
    function loadCustomers() {
      fetch('/api/customers')
        .then(response => response.json())
        .then(customers => {
          const tableBody = document.getElementById('customers-table');
          tableBody.innerHTML = '';
          
          customers.forEach(customer => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${customer.id}</td>
              <td>${customer.name}</td>
              <td>${customer.email}</td>
              <td>${customer.phone}</td>
              <td class="actions">
                <button onclick="viewCustomer('${customer.id}')">View</button>
                <button onclick="editCustomer('${customer.id}')">Edit</button>
                <button onclick="deleteCustomer('${customer.id}')">Delete</button>
              </td>
            `;
            tableBody.appendChild(row);
          });
        })
        .catch(error => console.error('Error loading customers:', error));
    }
    
    // Create new customer
    function createCustomer(customerData) {
      fetch('/api/customers', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(customerData)
      })
        .then(response => response.json())
        .then(data => {
          resetForm();
          loadCustomers();
          alert('Customer created successfully!');
        })
        .catch(error => console.error('Error creating customer:', error));
    }
    
    // View customer details
    function viewCustomer(id) {
      fetch(`/api/customers/${id}`)
        .then(response => response.json())
        .then(customer => {
          document.getElementById('customer-id').value = customer.id;
          document.getElementById('name').value = customer.name;
          document.getElementById('email').value = customer.email;
          document.getElementById('phone').value = customer.phone;
          document.getElementById('address').value = customer.address;
          document.getElementById('city').value = customer.city;
          document.getElementById('state').value = customer.state;
          document.getElementById('zip').value = customer.zip;
          document.getElementById('country').value = customer.country;
          
          formTitle.textContent = `Viewing Customer: ${customer.name}`;
          // Disable editing
          const inputs = form.querySelectorAll('input');
          inputs.forEach(input => input.disabled = true);
          document.querySelector('.submit-btn').style.display = 'none';
        })
        .catch(error => console.error('Error fetching customer:', error));
    }
    
    // Prepare form for editing
    function editCustomer(id) {
      fetch(`/api/customers/${id}`)
        .then(response => response.json())
        .then(customer => {
          document.getElementById('customer-id').value = customer.id;
          document.getElementById('name').value = customer.name;
          document.getElementById('email').value = customer.email;
          document.getElementById('phone').value = customer.phone;
          document.getElementById('address').value = customer.address;
          document.getElementById('city').value = customer.city;
          document.getElementById('state').value = customer.state;
          document.getElementById('zip').value = customer.zip;
          document.getElementById('country').value = customer.country;
          
          formTitle.textContent = `Edit Customer: ${customer.name}`;
          editing = true;
          
          // Enable editing
          const inputs = form.querySelectorAll('input');
          inputs.forEach(input => input.disabled = false);
          document.querySelector('.submit-btn').style.display = 'block';
        })
        .catch(error => console.error('Error fetching customer:', error));
    }
    
    // Update customer
    function updateCustomer(id, customerData) {
      fetch(`/api/customers/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(customerData)
      })
        .then(response => response.json())
        .then(data => {
          resetForm();
          loadCustomers();
          alert('Customer updated successfully!');
        })
        .catch(error => console.error('Error updating customer:', error));
    }
    
    // Delete customer
    function deleteCustomer(id) {
      if (confirm('Are you sure you want to delete this customer?')) {
        fetch(`/api/customers/${id}`, {
          method: 'DELETE'
        })
          .then(response => response.json())
          .then(data => {
            loadCustomers();
            alert('Customer deleted successfully!');
          })
          .catch(error => console.error('Error deleting customer:', error));
      }
    }
    
    // Reset form to initial state
    function resetForm() {
      form.reset();
      document.getElementById('customer-id').value = '';
      formTitle.textContent = 'Add New Customer';
      editing = false;
      
      // Enable all inputs
      const inputs = form.querySelectorAll('input');
      inputs.forEach(input => input.disabled = false);
      document.querySelector('.submit-btn').style.display = 'block';
    }
  </script>
</body>
</html>
